<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quáº£n lÃ½ ChuyÃªn khoa - Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Inter', sans-serif; }
    .btn { padding: 0.5rem 1rem; border-radius: 0.25rem; color: #fff; font-weight: 600; }
    .btn-blue { background-color: #2563eb; }
    .btn-blue:hover { background-color: #1d4ed8; }
    .btn-red { background-color: #dc2626; }
    .btn-red:hover { background-color: #b91c1c; }
    .btn-green { background-color: #16a34a; }
    .btn-green:hover { background-color: #15803d; }
  </style>
</head>

<body class="bg-gray-50 min-h-screen p-6">
  <div class="max-w-5xl mx-auto bg-white p-6 rounded-xl shadow">
    <h1 class="text-2xl font-bold text-blue-700 mb-4">ðŸ©º Quáº£n lÃ½ ChuyÃªn khoa</h1>

    <!-- ðŸ” Thanh tÃ¬m kiáº¿m -->
    <div class="flex flex-wrap items-center gap-3 mb-4">
      <input id="searchKeyword" type="text" placeholder="Nháº­p tÃªn chuyÃªn khoa..." class="border p-2 rounded w-60" />
      <button id="searchBtn" class="btn btn-blue">TÃ¬m kiáº¿m</button>
      <button id="addBtn" class="btn btn-green ml-auto">+ ThÃªm chuyÃªn khoa</button>
    </div>

    <!-- ðŸ“‹ Báº£ng danh sÃ¡ch -->
    <div class="overflow-x-auto">
      <table class="min-w-full border">
        <thead class="bg-blue-100 text-left">
          <tr>
            <th class="p-3 border">ID</th>
            <th class="p-3 border">TÃªn chuyÃªn khoa</th>
            <th class="p-3 border text-center">HÃ nh Ä‘á»™ng</th>
          </tr>
        </thead>
        <tbody id="specialtyTable" class="divide-y"></tbody>
      </table>
    </div>
  </div>

  <!-- ðŸ§© Modal ThÃªm / Sá»­a -->
  <div id="specialtyModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center">
    <div class="bg-white p-6 rounded-xl w-full max-w-md shadow-lg">
      <h2 id="modalTitle" class="text-xl font-bold text-blue-700 mb-4"></h2>
      <div class="space-y-3">
        <input id="specialtyName" type="text" placeholder="Nháº­p tÃªn chuyÃªn khoa" class="border p-2 rounded w-full" />
      </div>
      <div class="flex justify-end gap-2 mt-4">
        <button id="saveSpecialty" class="btn btn-green">LÆ°u</button>
        <button id="cancelSpecialty" class="btn btn-red">Há»§y</button>
      </div>
    </div>
  </div>

  <script>
    const apiBase = "http://localhost:5236/api";
    const token = localStorage.getItem("token");
    let specialties = [];
    let editingId = null;

    if (!token) {
      alert("Vui lÃ²ng Ä‘Äƒng nháº­p trÆ°á»›c!");
      window.location.href = "../Login/login.html?role=Admin";
    }

    const headers = { "Authorization": `Bearer ${token}`, "Content-Type": "application/json" };

    // ðŸš€ Load dá»¯ liá»‡u ban Ä‘áº§u
    window.onload = async () => {
      await loadSpecialties();
    };

    // ðŸ”¹ Load danh sÃ¡ch chuyÃªn khoa
    async function loadSpecialties() {
      const res = await fetch(`${apiBase}/Specialties`, { headers });
      specialties = await res.json();
      renderSpecialties();
    }

    // ðŸ”¹ Hiá»ƒn thá»‹ danh sÃ¡ch
    function renderSpecialties() {
      const tbody = document.getElementById("specialtyTable");
      tbody.innerHTML = "";
      specialties.forEach(s => {
        tbody.innerHTML += `
          <tr>
            <td class="p-3 border">${s.specialtyId}</td>
            <td class="p-3 border">${s.specialtyName}</td>
            <td class="p-3 border text-center">
              <button onclick="editSpecialty(${s.specialtyId})" class="text-blue-600 font-semibold mr-3">Sá»­a</button>
              <button onclick="deleteSpecialty(${s.specialtyId})" class="text-red-600 font-semibold">XÃ³a</button>
            </td>
          </tr>`;
      });
    }

    // ðŸ”¹ TÃ¬m kiáº¿m
    document.getElementById("searchBtn").addEventListener("click", () => {
      const keyword = document.getElementById("searchKeyword").value.trim().toLowerCase();
      const filtered = specialties.filter(s => s.specialtyName?.toLowerCase().includes(keyword));
      const tbody = document.getElementById("specialtyTable");
      tbody.innerHTML = "";
      filtered.forEach(s => {
        tbody.innerHTML += `
          <tr>
            <td class="p-3 border">${s.specialtyId}</td>
            <td class="p-3 border">${s.specialtyName}</td>
            <td class="p-3 border text-center">
              <button onclick="editSpecialty(${s.specialtyId})" class="text-blue-600 font-semibold mr-3">Sá»­a</button>
              <button onclick="deleteSpecialty(${s.specialtyId})" class="text-red-600 font-semibold">XÃ³a</button>
            </td>
          </tr>`;
      });
    });

    // ðŸ”¹ ThÃªm má»›i
    document.getElementById("addBtn").onclick = () => {
      editingId = null;
      document.getElementById("modalTitle").textContent = "ThÃªm chuyÃªn khoa";
      document.getElementById("specialtyName").value = "";
      document.getElementById("specialtyModal").classList.remove("hidden");
      document.getElementById("specialtyModal").classList.add("flex");
    };

    // ðŸ”¹ Sá»­a
    async function editSpecialty(id) {
      const res = await fetch(`${apiBase}/Specialties/${id}`, { headers });
      const s = await res.json();
      editingId = id;
      document.getElementById("modalTitle").textContent = "Chá»‰nh sá»­a chuyÃªn khoa";
      document.getElementById("specialtyName").value = s.specialtyName;
      document.getElementById("specialtyModal").classList.remove("hidden");
      document.getElementById("specialtyModal").classList.add("flex");
    }

    // ðŸ”¹ LÆ°u (ThÃªm hoáº·c cáº­p nháº­t)
    document.getElementById("saveSpecialty").onclick = async () => {
      const name = document.getElementById("specialtyName").value.trim();
      if (!name) return alert("Vui lÃ²ng nháº­p tÃªn chuyÃªn khoa.");

      const method = editingId ? "PUT" : "POST";
      const url = editingId ? `${apiBase}/Specialties/${editingId}` : `${apiBase}/Specialties`;

      const res = await fetch(url, { method, headers, body: JSON.stringify({ specialtyName: name }) });
      if (res.ok) {
        alert(editingId ? "Cáº­p nháº­t thÃ nh cÃ´ng!" : "ThÃªm má»›i thÃ nh cÃ´ng!");
        document.getElementById("specialtyModal").classList.add("hidden");
        loadSpecialties();
      } else alert("Thao tÃ¡c tháº¥t báº¡i!");
    };

    // ðŸ”¹ XÃ³a
    async function deleteSpecialty(id) {
      if (!confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a chuyÃªn khoa nÃ y?")) return;
      const res = await fetch(`${apiBase}/Specialties/${id}`, { method: "DELETE", headers });
      if (res.ok) {
        alert("ÄÃ£ xÃ³a!");
        loadSpecialties();
      } else alert("KhÃ´ng thá»ƒ xÃ³a!");
    }

    // ðŸ”¹ Há»§y modal
    document.getElementById("cancelSpecialty").onclick = () => {
      document.getElementById("specialtyModal").classList.add("hidden");
    };
  </script>
</body>
</html>
